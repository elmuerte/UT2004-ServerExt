<h1>ServerExt</h1>
ServerExt is a package containing extentions for UT2004 servers. It consist out of a couple of independed components:
<ul>
	<li><a href="#chatfilter">Chat Filter</a></li>
	<li><a href="#playerjoinlog">Player join log</a></li>
	<li><a href="#reservedslots">Reserved slots</a></li>
	<li><a href="#mutrss">RSS Feed Mutator</a></li>
	<li><a href="#servquery">ServQuery</a></li>
	<li><a href="#statschatlog">Stats chat log</a></li>
	<li><a href="#teambalance">Team Balance mutator</a></li>
</ul>
More components will be added in the future. <br />
The ServerExt package is being developed by <a href="http://wiki.beyondunreal.com/wiki/ElMuerte">Michiel "El Muerte" Hendriks</a>. This is an unofficial add-on and not supported by Atari support.

<h2>Downloads</h2>
New versions of this package can be downloaded from <a href="http://ut2004.elmuerte.com/ServerExt">the ServerExt website</a>.<br />
<ul>
	<li>Version 106 <a href="http://ut2004.elmuerte.com/files/ServerExt-v106.zip">[zip]</a> <a href="http://ut2004.elmuerte.com/files/ServerExt-v106-ut4mod.zip">[ut4mod]</a></li>
	<li>Version 105b <a href="http://ut2004.elmuerte.com/files/ServerExt-v105b.zip">[zip]</a> <a href="http://ut2004.elmuerte.com/files/ServerExt-v105b-ut4mod.zip">[ut4mod]</a></li>
	<li>Version 105a <a href="http://ut2004.elmuerte.com/files/ServerExt-v105a.zip">[zip]</a> <a href="http://ut2004.elmuerte.com/files/ServerExt-v105a-ut4mod.zip">[ut4mod]</a></li>
	<li>Version 105 <a href="http://ut2004.elmuerte.com/files/ServerExt-v105.zip">[zip]</a> <a href="http://ut2004.elmuerte.com/files/ServerExt-v105-ut4mod.zip">[ut4mod]</a></li>
	<li>Version 104 <a href="http://ut2004.elmuerte.com/files/ServerExt-v104.zip">[zip]</a> <a href="http://ut2004.elmuerte.com/files/ServerExt-v104-ut2mod.zip">[ut2mod]</a></li>
	<li>Version 103 <a href="http://ut2004.elmuerte.com/files/ServerExt-v103.zip">[zip]</a> <a href="http://ut2004.elmuerte.com/files/ServerExt-v103-ut2mod.zip">[ut2mod]</a></li>
	<li>Version 102 <a href="http://ut2004.elmuerte.com/files/ServerExt-v102.zip">[zip]</a> <a href="http://ut2004.elmuerte.com/files/ServerExt-v102-ut2mod.zip">[ut2mod]</a></li>
	<li>Version 101 <a href="http://ut2004.elmuerte.com/files/ServerExt-v101.zip">[zip]</a> <a href="http://ut2004.elmuerte.com/files/ServerExt-v101-ut2mod.zip">[ut2mod]</a></li>
	<li>Version 100 <a href="http://ut2004.elmuerte.com/files/ServerExt-v100.zip">[zip]</a></li>
</ul>

<h2>License for ServerExt</h2>
<pre>
<a href="http://wiki.beyondunreal.com/wiki/OpenUnrealModLicense">Open Unreal Mod License</a>
Version 1, March 2004

0. Definitions
"Program"       the work, either in binary or source form, that has a notice
				attached to it stating that it has been released under this
				license it by the copyright holder.
"Modification"  a derivate of the Program or any other work based on the Program
"Linking"       using parts of the Program, or using parts of any other work,
				thus creating a direct dependency
"You"           the licensee
"Runtime Environment"
				the virtual machine or operating system required to run the
				Program, as released by the Publisher or Creator of said
				runtime environment. This includes any extentions or updates
				for the runtime environment released by the Publisher or
				Creator.

1. License
Herewith everybody is granted permission to copy and distribute verbatim copies
of this document. The only restriction lies on changing the content, with the
exception to translation of this license.

This license applies to the Program that has been released under this license.
The license only applies to copying, distribution and modification of the
Program. Execution or output of the Program are not covered by this license,
however the right for additional limitations on the use (that do not cover
copying, distribution or modification) is granted to the copyright holder.
This license is only valid when all terms in this license comply with the
licenses of the dependecies of the Program. This includes the license of the
possible required runtime environment.

2. Copying and distribution
You are granted to copy or distribute verbatim copies of the Program, on any
medium, or in any format as you see fit. You are not limited to charging a fee
for the physical act of transferring the copy, nor are you limited to provide
warranty for the Program in return of a fee. Unless this is prohibited by the
license of the Runtime Environment.

Any distribution of the program should be accompanied with a verbatim copy of
this license.

3. Modification
You are allowed to modify the Program, or portions of it, therefore making it a
derivate of the Program. You are allowed to distribute your modifications under
the following conditions:
		- You must clearly state that it is a modification or derivate of the
		  Program
		- The original copyright notice must be kept intact
		- The modified files must contain notices of the changed made to it
		- The Modification must be released under the same license as the Program
		- Distribution happens in compliance with section 2

4. Source
The original source of the Program or Modification must be freely available on
request.

5. Linking
The Program or Modification may only link with other work that have been
released as free software.

The license grants exclusive right to link with any part of the Runtime
Environment, as provided by the publisher or creator of said Runtime
Environment.
Reusing pieces of source code available in the runtime environment in the
Program is only allowed under the following terms:
		- the "borrowed" code is clearly marked to originate from the runtime
		  environment, quoting the original copyright.
		- the following notice is added to the top of the file:
		  "This file contains portions of code from the runtime environment."

The right to "port" the Program to another runtime environment is reserved for
the copyright holder.

6. NON WARRANTY
THIS SOFTWARE DOES NOT COME WITH A WARRANTY OF ANY KIND, UNLESS NOTED OTHERWISE
BY THE COPYRIGHT HOLDER OR WARRANTY PROVIDER. THE ENTIRE RISK OF THE PERFORMANCE
AND QUALITY OF THE PROGRAM LIES WITH YOU. SHOULD THE PROGRAM PROVE DEFECTIVE,
YOU WILL ASSUME ALL COSTS FOR REQUIRED OF REPAIR OR CORRECTION.
</pre>

<h2>Revision history</h2>
<h3>Changes since v105b</h3>
<ul>
	<li>Fixed BM_Sequential mode for mutRSS</li>
	<li>Client packages split up into two: one for ChatFilter and one for mutRSS</li>
	<li>mutRSS now uses LibHTTP3</li>
	<li>Fixed recursion issue in ChatFilter (e.g. replace xxx -> x doesn't crash the server anymore)<li>
	<li>Fixed an issue with spaces in bad words</li>
	<li>Fixed warning mutator for ChatFilter</li>
	<li>Added a new option: bWarnVoting, only when this is set the voting mutator will be used and allow people to vote on a judgement of a player.</li>
</ul>

<h3>Changes since v105a</h3>
<ul>
	<li>ReservedSlots, ReservedSlotsIni and SlotManager are now compiled with `parseconfig`. This means you change the config file to use on the commandline: <code>-ReservedSlots=myini.ini</code>, <code>-ReservedSlotsIni=myini.ini</code>, <code>-SlotManager=myini.ini</code>. The settings in the system config are loaded before the specified config file.</li>
</ul>

<h3>Changes since v105</h3>
<ul>
	<li>Fixed a couple of issues with text fields in the webadmin</li>
	<li>Fixed reserved slots using name or password as check</li>
</ul>

<h3>Changes since v104</h3>
<ul>
	<li>Removed bFriendlymessage from ChatFilter, friendly messages are now always used and doesn't require the client side package</li>
	<li>Added reserved slot feature</li>
	<li>Added team balancer mutator</li>
	<li>Fixed chat logging for spectators, requires an updated version of utstatsdb before it work (any version newer than 2.21)</li>
	<li>Fixed gamepassword not being passed by ServQuery</li>
</ul>

<h3>Changes since v103</h3>
<ul>
	<li>Removed debug log spam</li>
	<li>Fixed a couple of accessed nones in chatfilter</li>
</ul>

<h3>Changes since v102</h3>
<ul>
	<li>The RSS Feed configuration can now also be saved in an other config file than the RSS.ini. This has been added for GISPs, if you do not host multiple servers from the same location with different admins, then you should not use this feature.</li>
	<li>Fixed "sequential" feed order with only one available feed</li>
	<li>Fixed the client side browser</li>
	<li>Added a new config option to MutRSS: bAnnounce<br />This will controll announcing this mutator to the master server</li>
	<li>Fixed incorrect chatlogging in chatfilter</li>
	<li>Fixed a couple of accessed nones in chatfilter</li>
</ul>

<h3>Changes since v101</h3>
<ul>
	<li>Included the webadmin pages for MutRSS</li>
	<li>Fixed MutRSS webadmin removing admin\users tab</li>
</ul>

<h3>Changes since v100</h3>
<ul>
	<li>Fixed duplicate chat log entries</li>
	<li>Ported the ChatFilter from UT2003</li>
</ul>

<h2>General Installation</h2>
Copy the following files to the System directory of your UT2004 servers:
<ul>
	<li>LibHTTP3.u</li>
	<li>ServerExt.int</li>
	<li>ServerExt.u</li>
	<li>ServerExt.ucl</li>
	<li>ServerExtClientA.u</li>
	<li>ServerExtClientA.int</li>
	<li>ServerExtClientB.u</li>
	<li>ServerExtClientB.int</li>
	<li>wUtils.u</li>
</ul>
Remove the old ServerExtClient.u, ServerExtClient10*.u files from you system and configuration.<br />
<br />
Copy the following files to the Web\ServerAdmin directory of your UT2004 servers:
<ul>
	<li>rssfeeds.htm</li>
	<li>slotmanager.htm</li>
	<li>slotmanager-entry.inc</li>
</ul>

<hr />
<a name="chatfilter"></a><h1>Chat Filter</h1>
ChatFilter is a server add-on to clean up the chatting on a server. ChatFilter has the power to reduce spamming on a server, it can also filter bad words from the line. On bad behavior the player will get a score assigned on a defined level actions can taken against the player. It's pretty much the same as ChatFilter for UT2003.<br />
Chat Filter requires version 3197 or higher, the retail contains a bug that prevents ChatFilter from working correctly.

<h2>Installation</h2>
Add <code>ServerExt.ChatFilter</code> to the Server Actors list in your system configuration
<pre>
[Engine.GameEngine]
ServerActors=ServerExt.ChatFilter
</pre>

<h2>Configuration</h2>
<h3>UT2004.ini</h3>
The configuration of the behavior of ChatFilter resides in the server configuration file (UT2003.ini). Add the following lines to the file:
<pre>
[ServerExt.ChatFilter]
fTimeFrame=1.0000
iMaxPerTimeFrame=2
iMaxRepeat=1
iScoreSpam=1
CencorWord=*****
iScoreSwear=1
iKillScore=10
KillAction=CFA_Nothing
BadWords=asshole
BadWords=fuck
...
bShowMuted=false
bUseReplacementTable=false
bCheckNicknames=false
BadnickAction=BNA_Kick
UnallowedNicks=Player
UnallowedNicks=Admin
...
bWildCardNicks=true
sWarningNotification="ChatFilter: Please clean up your act"
sWarningBroadcast="%s is chatting abusive, type 'mutate cf judge %i` to judge the player"
WarningAction=CFA_Kick
iMaxWarnings=2
fMinVote=0.5000
sMuteMessage="ChatFilter: You are muted the rest of the game"
bLogChat=false
sFileFormat="ChatFilter_%P_%Y_%M_%D_%H_%I_%S"
</pre>
<dl>
	<dt>fTimeFrame</td>
	<dd>Set the number of seconds of a single time frame</dd>
	<dt>iMaxPerTimeFrame</td>
	<dd>Maximum number of lines allowed per time frame</dd>
	<dt>iMaxRepeat</td>
	<dd>The maximum times a player can say the same line in a row</dd>
	<dt>iScoreSpam</td>
	<dd>The score to add when a player exceeds the iMaxRepeat value</dd>
	<dt>CencorWord</td>
	<dd>Text to replace BadWords with</dd>
	<dt>iScoreSwear</td>
	<dd>The score to add for every bad word</dd>
	<dt>iKillScore</td>
	<dd>The maximum score a player may have before actions will be taken</dd>
	<dt>KillAction</td>
	<dd>Action to take against the player:
		<ul>
		  <li> CFA_Nothing do nothing</li>
		  <li> CFA_Kick kick the player</li>
		  <li> CFA_Ban ban the player</li>
		  <li> CFA_SessionBan ban the player for this game</li>
		  <li> CFA_Defrag remove one point of the players score</li>
		  <li> CFA_Warn the player will be warned</li>
		  <li> CFA_Mute the player will be muted for the rest of the game </li>
		  </ul>
	</dd>
	<dt>BadWords</td>
	<dd>Words that are considderd bad/swearing. By default no words are added</dd>
	<dt>bUseReplacementTable</td>
	<dd>Uses the a per badword replacement, BadWords have to be divided with a ; to change the replacement, or the default if omitted. For example:<br />
	  BadWords=shit;sh*t<br />
	  BadWords=hate;love</dd>
	<dt>bShowMuted</dt>
	<dd>Update the HUD to show when a player has been muted</dd>
	<dt>bCheckNicknames</td>
	<dd>Check the players nick name for BadWords.</dd>
	<dt>BadnickAction</dt>
	<dd>Action to take on a bad nick name
		<ul>
		  <li> BNA_Kick kick the player</li>
		  <li> BNA_Request request a nick change, don't kick</li>
		  <li> BNA_Ban ban the player</li>
		  <li> BNA_SessionBan ban the player for this game</li>
		  </ul>
	</dd>
	<dt>bWildCardNicks</dt>
	<dd>Accept wildcards in the bad nick name list</dd>
	<dt>UnallowedNicks</dt>
	<dd>List with nick names that are never allowed for players</dd>
	<dt>sWarningNotification</td>
	<dd>The message a player will get when he gets warned</dd>
	<dt>sWarningBroadcast</td>
	<dd>The message all players get when somebody get's warned. "%s" is replaced by the player name, and "%i" is replaced by the filter record contain information about this user, required for the `mutate cf judge` command</dd>
	<dt>WarningAction</td>
	<dd>The action to take when a player get's voted off or exceeds the maximum warnings. You can choose from the same actions as KillAction, except CFA_Warn ofcourse</dd>
	<dt>iMaxWarnings</td>
	<dd>The maximum number of warnings before the server automatically takes action</dd>
	<dt>fMinVote</td>
	<dd>The minimum percentage of players on the server that have to vote before actions are taken against the warned player</dd>
	<dt>sMuteMessage</td>
	<dd>The message a player get's when he's muted for the rest of the game</dd>
	<dt>bLogChat</td>
	<dd>Save the chat to a log file</dd>
	<dt>sFileFormat</td>
	<dd>The format for the log filename. You can use the following replacements:
	<ul>
		  <li> %P server Port</li>
		  <li> %Y current Year</li>
		  <li> %M current Month</li>
		  <li> %Y current Day</li>
		  <li> %H current Hour</li>
		  <li> %I current mInute</li>
		  <li> %S current Second</li>
		  <li> %N server Name </li>
	</ul>
	  Not all characters are supported in the filename, for example '.', these will be translated to an underscore '_' </dd>
</dl>

The log file generated will start with a line with the date the log started:

  --- Log started on 2003/2/28 21:17:40

After that you will get the log files in there field (seperated by tabs)

  time  tag  playername  message

Tag is one of the following:

  CHAT, TEAMCHAT, SPAM, TEAMSPAM, MUTE, TEAMMUTE

The lines are uncensored (the bad words are not filtered)

<hr />
<a name="playerjoinlog"></a><h1>Player Join Log</h1>
Player Join Log is the UT2004 equivalent of PlayerJoinDumpSE for UT2003. It will dump player joins/parts and nick changes to a log file.<br />
The following types of lines will be dumped to the log file:
<pre>
[PLAYER_JOIN] &lt;time stamp&gt;	&lt;name&gt;	&lt;IP&gt;	&lt;net speed&gt;	&lt;Player ID hash&gt;
[PLAYER_NAME_CHANGE]	&lt;time stamp&gt;	&lt;old name&gt;	&lt;new name&gt;
[PLAYER_PART]	&lt;time stamp&gt;	&lt;name&gt;
</pre>
The fields are seperated with TAB characters. <br />
Spectator information is also dumped, but the following tags are used: <code>[SPECTATOR_JOIN]</code>, <code>[SPECTATOR_NAME_CHANGE]</code> and <code>[SPECTATOR_PART]</code>

<h2>Installation</h2>
Add <code>ServerExt.PlayerJoinLog</code> to the Server Actors list in your system configuration
<pre>
[Engine.GameEngine]
ServerActors=ServerExt.PlayerJoinLog
</pre>

<h2>Configuration</h2>
<h3>UT2004.ini</h3>
<pre>
[ServerExt.PlayerJoinLog]
bExternalLog=false
sFileFormat="PlayerJoin_%P_%Y_%M_%D_%H_%I_%S"
</pre>
<dl>
	<dt>bExternalLog</dt>
	<dd>If set to true an external log file will be used instead of the standard log file. External log files will be saved in the UserLog directory.</dd>
	<dt>sFileFormat</dt>
	<dd>This set's the filename of the external log file. The following replacements can be used:
	<table>
		<tr><td><code>%P</code></td><td>server port</td></tr>
		<tr><td><code>%N</code></td><td>server name</td></tr>
		<tr><td><code>%P</code></td><td>year</td></tr>
		<tr><td><code>%M</code></td><td>month</td></tr>
		<tr><td><code>%D</code></td><td>day</td></tr>
		<tr><td><code>%W</code></td><td>day of the week</td></tr>
		<tr><td><code>%H</code></td><td>hour</td></tr>
		<tr><td><code>%I</code></td><td>minute</td></tr>
		<tr><td><code>%S</code></td><td>second</td></tr>
	</table>
	</dd>
</dl>

<hr />
<a name="reservedslots"></a><h1>Reserved slots</h1>
This add-on allows you to add reserved slots. Players with the correct login details can still enter a server that is at capicity. <br />
This add-on replaces the AccessControl (both the single admin and multiple admin system are supported), so this mod doesn't work with other mods that replace the AccessControl.<br />

<h2>Installation</h2>
If you are using the single admin system you will have to change the following setting:
<pre>
[Engine.GameInfo]
AccessControlClass=ServerExt.ReservedSlots
</pre>
If you are using the multiple admin system (xAdmin) you will have to change it to:
<pre>
[Engine.GameInfo]
AccessControlClass=ServerExt.ReservedSlotsIni
</pre>

<h2>Configuration</h2>
The reserved slots can be configured via the WebAdmin. A new page is added to the main list, this page allows you to edit the reserved slots. The other settings might be available via the "defaults" page.<br />
But you can also change the settings directly in the UT2004.ini file:
<pre>
[ServerExt.SlotManager]
AbsoluteMaxPlayers=0
AbsoluteMaxSpectators=0
Slots=(Data="12345678901234567890123456789012",Type=ST_Hash,specOnly=False,Method=SOM_Expand)
Slots=(Data="192.168.*",Type=ST_IP,specOnly=False,Method=SOM_KickRandom)
...
</pre>
<dl>
	<dt>AbsoluteMaxPlayers</dt>
	<dd>This is the absolute maximum limit for players, the player count will never increase more than this value. If this value is zero or less there won't be a limit</dd>
	<dt>AbsoluteMaxSpectators</dt>
	<dd>Same as AbsoluteMaxPlayers but for spectators</dd>
	<dt>Slots</dt>
	<dd>This is a list of reserved slots. You can have an unlimited number of slot configuration. Each entry has the following fields:
		<dl>
			<dt>data</dt>
			<dd>This contains the information to check, the format depends on the type. You can use the following wildcards: * = zero or many characters, ? = one character</dd>
			<dt>type</dt>
			<dd>This is the type of the slot, it set what information to check.
			<ul>
				<li>ST_IP - IP address</li>
				<li>ST_Hash - CDKey hash</li>
				<li>ST_Nick - Requested nick name</li>
				<li>ST_Password - The password entered on the connect url (?password=[somepassword])</li>
				<li>ST_Options - Match with the connect url. This can be usefull to keep the check comepletely secret. For example a the data contains "*MySecret=URLOption*", if the player joins the server with: ip.to.server?name=MyNick?MySecret=URLOption (or similar) it will match.</li>
			</dd>
			<dt>specOnly</dt>
			<dd>if set to True this slot is for spectators only</dd>
			<dt>method</dt>
			<dd>The method to use to make room for this player.
			<ul>
				<li>SOM_Expand - increase the max limit (adviced method)</li>
				<li>SOM_KickRandom - use a random kick method</li>
				<li>SOM_KickWorst - kick the player with the lowest score/death ration</li>
				<li>SOM_KickBest - kick the player with the highest score/death ration</li>
				<li>SOM_KickOldest - kick the player that been the longest on the server</li>
				<li>SOM_KickNewest - kick the player that joined last</li>
			</ul>
			</dd>
		</dl>
	</dd>
</dl>
By default the system has only one SlotManager installed (ServerExt.SlotManager). It's possible to program additional SlotManagers. To add new slot managers you have to change the following:
<pre>
[ServerExt.ReservedSlots]
SlotManagerClasses=ServerExt.SlotManager
SlotManagerClasses=MyExtentions.MySlotManager
...
</pre>
Note: if you installed the ReservedSlotsIni as AccessControl it should be the section "[ServerExt.ReservedSlotsIni]"<br />
Information on writing a SlotManager can be found in the source code of ServerExt.

<h3>Alternative config file</h3>
To change the config file used by ReservedSlots, ReservedSlotsIni and SlotManager you have to specify the following option on your commandline: <code>-<i>class</i>=myini.ini</code>. For ReservedSlots this would be for example:
<pre>
ucc server dm-mymap?game=xgame.xteamgame?.... ini=server.ini log=server.log <u>-ReservedSlots=MyPolicies.ini</u>
</pre>
Changing the configuration file for ReservedSlots and ReservedSlotsIni will also save the IP and CDKey Hash Policies in that new configuration file.

<hr />
<a name="servquery"></a><h1>ServQuery</h1>
ServQuery is a replacement for the default GameSpy query protocol that comes with UT2004. It adds quite some additional information, like team info, more detailed server information. And even the map list can be retrieved. <br />
For information about how to query a server using this interface refer to <a href="http://wiki.beyondunreal.com/wiki/UT_Server_Query" target="_blank">this UnrealWiki page</a>. There are some tools that use the extended features of ServQuery, these tools incluse: <a href="http://www.unrealza.co.za/proasm/ut2mon.html" target="_blank">UT2Monitor</a> and <a href="http://ut2003stats.sourceforge.net/" target="_blank">UT Stats DB</a>.<br />
<br />
The following queries are added:
<h4><code>\about\</code></h4>
Returns about information, you can use this to check if a server has ServQuery installed, and what version.<br />
Reply:
<code>\about\ServQuery &lt;version&gt;\author\Michiel 'El Muerte' Hendriks\authoremail\elmuerte@drunksnipers.com\HighestRequestCount\&lt;count&gt;</code>

<h4><code>\bots\</code></h4>
Return information about the bots on the server<br />
Reply for each bot:
<code>\bot_&lt;id&gt;\&lt;bot name&gt;\ping_&lt;id&gt;\&lt;fake bot ping, if any&gt;</code>

<h4><code>\gamestatus\</code></h4>
Returns additional status of the current game<br />
Reply:
<code>\elapsedtime\&lt;elapsed time of the game&gt;\timeseconds\&lt;seconds the game is active&gt;\starttime\&lt;time the game started at&gt;\overtime\&lt;true if in overtime&gt;\gamewaiting\&lt;true if waiting to start&gt;\nextmap\&lt;next map&gt;\</code>

<h4><code>\playerhashes_???\</code></h4>
Returns the Player ID hashes, the ??? in the query is the password as set in the configuration to protect this query<br />
Reply for each player:
<code>\phname_&lt;id&gt;\&lt;player name&gt;\phash_&lt;id&gt;\&lt;player id hash&gt;\phip_&lt;id&gt;\&lt;player IP&gt;\</code>

<h4><code>\maplist\</code></h4>
Returns the current maplist in rotation<br />
Reply for each map:
<code>\maplist_&lt;id&gt;\&lt;map name&gt;\</code>

<h4><code>\spectators\</code></h4>
Returns information about the connected spectators, if any.<br />
Reply for each spectator:
<code>\spectator_&lt;id&gt;\&lt;name&gt;\specping_&lt;id&gt;\&lt;spectator's ping&gt;\</code>

<h4><code>\teams\</code></h4>
Returns information about the teams, if it's a team game<br />
Reply for each team:
<code>\team_&lt;id&gt;\&lt;team name&gt;\score_&lt;id&gt;\&lt;team score&gt;\size_&lt;id&gt;\&lt;number of team members&gt;\</code>

<h2>Installation</h2>
Add <code>ServerExt.SQMSUplink</code> to the Server Actors list in your system configuration
<pre>
[Engine.GameEngine]
ServerActors=ServerExt.SQMSUplink
</pre>
And make sure you remove the Server Actor <code>IpDrv.MasterServerUplink</code>

<h2>Configuration</h2>
<h3>UT2004.ini</h3>
<pre>
[ServerExt.ServQuery]
bVerbose=false
sReplyTo="TASGMEBH"
ePType=PT_None
iTimeframe=60
iMaxQueryPerFrame=180
iMaxQueryPerHostPerFrame=10
sPassword=
</pre>
<dl>
	<dt>bVerbose</dt>
	<dd>Set to true to increase the verbosity, this is only used when the flood propection is used</dd>

	<dt>sReplyTo</dt>
	<dd>Defines the extended queries ServQuery will respond to. It can contain the following values:
	<table>
		<tr><td><code>A</code></td><td>\about\</td></tr>
		<tr><td><code>B</code></td><td>\bots\</td></tr>
		<tr><td><code>E</code></td><td>\echo\</td></tr>
		<tr><td><code>G</code></td><td>\gamestatus\</td></tr>
		<tr><td><code>H</code></td><td>\playerhashes_???\</td></tr>
		<tr><td><code>M</code></td><td>\maplist\</td></tr>
		<tr><td><code>S</code></td><td>\spectators\</td></tr>
		<tr><td><code>T</code></td><td>\teams\</td></tr>
	</table>
	</dd>

	<dt>ePType</dt>
	<dd>Query flood protection. When this value is changed to anything other than PT_None a basic flood protection is enabled. When a set threshhold is reached ServQuery will not respond to queries for the rest of the time frame. Enabling flood protection generates a slight preformance decrease. The following values are allowed:
	<table>
		<tr><td><code>PT_None</code></td><td>none</td></tr>
		<tr><td><code>PT_PerFrame</code></td><td>maximum queries in total per frame</td></tr>
		<tr><td><code>PT_HostPerFrame</code></td><td>maximum queries per host per frame</td></tr>
		<tr><td><code>PT_Both</code></td><td>use both total maximum and per host</td></tr>
	</table>
	</dd>

	<dt>iTimeframe</dt>
	<dd>The length (in seconds) of a time frame.</dd>

	<dt>iMaxQueryPerFrame</dt>
	<dd>The threshold for PT_PerFrame</dd>

	<dt>iMaxQueryPerHostPerFrame</dt>
	<dd>The threshold for PT_HostPerFrame</dd>

	<dt>sPassword</dt>
	<dd>The secret string to get the player hashes, should be included in the query: \playerhashes_YOURPASSWORD\</dd>
</dl>


<hr />
<a name="statschatlog"></a><h1>Stats chat log</h1>
The standard stats logging that comes with UT2004 does not log the chats to the log file. This addon will enable chat logging into the stats log file. It will only log chats to the local log and does not disrupt the global logging. The logging is compatible with the old LocalLog and LocalStats chat logging.

<h2>Installation</h2>
Add <code>ServerExt.StatsChatLog</code> to the Server Actors list in your system configuration
<pre>
[Engine.GameEngine]
ServerActors=ServerExt.StatsChatLog
</pre>

<h2>Configuration</h2>
No configuration required

<hr />
<a name="mutrss"></a><h1>RSS Feed Mutator</h1>
The RSS Feed mutator is a replacement for the ServerAdsSE server addon for UT2003. It has the same functionality, with the major exception that it will retrieve the content from so called <a href="http://feedvalidator.org/docs/rss2.html" target="_blank">RSS Feeds</a>.<br />
A lot of sites and portal software provide a way to syndicate news via RSS files. This mutator allows you do display this news in the UT2004 game.

<h2>Installation</h2>
The mutator can either be installed as Mutator or as Server Actor. <br />
When installed as Server Actor you won't have the "mutate" functionality, and it won't show up in the mutator listing.<br />
There are two versions of this mutator available, one stores it's configuration in the UT2004.ini (system) file: <code>ServerExt.MutRSS</code> and the other stores it's configuration in the RSS.ini files: <code>ServerExt.MutRSSCentral</code>. <br />
If you run multiple servers and want the same configuration for all servers use the <code>ServerExt.MutRSSCentral</code> version.<br />
If you want to install this mutator the normal way (as a mutator) at it to the mutator list of your commandline: <code>?mutator=ServerExt.MutRSS</code><br />
If you want to install it as a Server Actor add <code>ServerExt.MutRSS</code> to the server actor list in the server configuration (UT2004.ini):
<pre>
[Engine.GameEngine]
ServerActors=ServerExt.MutRSS
</pre>
This mutator features a client side RSS Feed browser (only when installed as a mutator).

<h2>Configuration</h2>
<h3>Mutator configuration</h3>
If you use <code>MutRSS</code> this configuration should go in the server's configuration (UT2004.ini), if you use <code>MutRSSCentral</code> it should be in RSS.ini<br />
Most of the configuration can also be set via the WebAdmin: defaults -> RSS Feeds<br />

<pre>
[ServerExt.MutRSS]
bEnabled=true
bAnnounce=true
sExlusiveFeeds=
bBroadcastEnabled=true
fBroadcastDelay=60
bInitialBroadcast=false
BroadcastMethod=BM_Sequential
iBroadcastMessages=2
iGroupSize=1
sBroadcastFormat="%title% [%ftitle%]"
bInteractive=true
bBrowserEnabled=true
bUpdateEnabled=true
iDefUpdateInterval=45
</pre>

<dl>
	<dt>bEnabled</dt>
	<dd>Global switch to enable/disable the mutator</dd>

	<dt>bAnnounce</dt>
	<dd>announce to the masterserver and clients that we are running this mutator</dd>

	<dt>sExlusiveFeeds</dt>
	<dd>Comma seperated list of RSS Feed names to use, leave blank to use all enabled RSS feeds</dd>

	<dt>bBroadcastEnabled</dt>
	<dd>If true the items in the RSS feeds will be broadcasted</dd>

	<dt>fBroadcastDelay</dt>
	<dd>the time, in seconds, between broadcasts</dd>

	<dt>bInitialBroadcast</dt>
	<dd>broadcast the first entry when the map has finished loading, usualy nobody has connect by then</dd>

	<dt>BroadcastMethod</dt>
	<dd>The method of broadcasting
	<table>
	<tr>
		<td><code>BM_Linear</code></td>
		<td>display the lines in a row</td>
	</tr>
	<tr>
		<td><code>BM_Random</code></td>
		<td>display random lines from all feeds</td>
	</tr>
	<tr>
		<td><code>BM_RandomFeed</code></td>
		<td>display random lines from a single (random) feed, every broadcast</td>
	</tr>
	<tr>
		<td><code>BM_Sequential</code></td>
		<td>display lines from feeds in a row (feed 1, line 1; feed 2 line 1; feed 3 line 1; feed 1 line 2; ...)</td>
	</tr>
	</table>
	</dd>

	<dt>iBroadcastMessages</dt>
	<dd>Number of groups of message to display per broadcast</dd>

	<dt>iGroupSize</dt>
	<dd>The number of lines in a group.<br />
	iGroupSize=1 means only one line at the time,
	a group size of n displays the the first min(n, length) entries starting
	from the selected index. The total number of lines displayed is:
	iBroadcastMessages * iGroupSize. When using BM_Linear you get the same result
	for iBroadcastMessages=1 ; iGroupSize=2 and iBroadcastMessages=2 ; iGroupSize=1</dd>

	<dt>sBroadcastFormat</dt>
	<dd>The format of the lines broadcasted. You can use the following replacements
	<table>
	<tr>
		<td><code>%title%</code></td>
		<td>the title of the message</td>
	</tr>
	<tr>
		<td><code>%link%</code></td>
		<td>the link of the message</td>
	</tr>
	<tr>
		<td><code>%desc%</code></td>
		<td>the content/description of the message, if any</td>
	</tr>
	<tr>
		<td><code>%no%</code></td>
		<td>the index of the message in the feed</td>
	</tr>
	<tr>
		<td><code>%fno%</code></td>
		<td>the index of the feed</td>
	</tr>
	<tr>
		<td><code>%ftitle%</code></td>
		<td>the title of the feed</td>
	</tr>
	<tr>
		<td><code>%flink%</code></td>
		<td>the link of the feed</td>
	</tr>
	<tr>
		<td><code>%fdesc%</code></td>
		<td>the description of the feed	</td>
	</tr>
	</table></dd>

	<dt>bInteractive</dt>
	<dd>If set to true the "mutate rss" console commands can be used (only when installed as mutator)</dd>

	<dt>bBrowserEnabled</dt>
	<dd>If set to true players can open the RSS Feed Browser ("mutate rss browser")</dd>

	<dt>bUpdateEnabled</dt>
	<dd>Should the mutator check for updates of the RSS Feed on start up?</dd>

	<dt>iDefUpdateInterval</dt>
	<dd>The default update interval of new RSS Feeds</dd>
</dl>

<h3>RSS Feed configuration</h3>
RSS Feeds can also be configured via the WebAdmin, using the "RSS Feeds" sub page next to the "current" and "default" links.<br />
All RSS Feeds are saved in the RSS.ini file. You can virtually have as many RSS Feeds as you want. Each feed has it's own configuration section. Each section starts with:
<pre>
[&lt;feed_name&gt; RSSFeedRecord]
</pre>
Where &lt;feed_name&gt; is a unique name of the feed. You may <b>not</b> use spaces in this name. However, this name will never be used when displaying information on screen (only in log files you will see this name again).<br />
Each feed has the following user configurable options:
<dl>
	<dt>rssHost</dt>
	<dd>The actual name of the feed. This will be used as fallback when it didn't receive the real name from the RSS feed.</dd>

	<dt>rssLocation</dt>
	<dd>The location to the RSS file</dd>

	<dt>rssEnabled</dt>
	<dd>True if this feed is enabled. Disabled feeds won't be used during broadcasting or updating.</dd>

	<dt>rssUpdateInterval</dt>
	<dd>Number of minutes between updates, don't set this too low. 45 minutes is a nice value. If this value is 0 the feed will never be updated, usefull for feeds that are not updated from a weblocation</dd>

	<dt>TextColor</dt>
	<dd>The color to use when showing the entries of this feed.<br />
	Format: <code>(R=0,G=255,B=255,A=255)</code></dd>
</dl>

After a feed has been updated the following additional entries will be saved to the RSS.ini file (for each feed). This information comes directly from the RSS files and should not be modified.

<dl>
	<dt>LastUpdate</dt>
	<dd>UNIX timestamp of the last update of the feed</dd>

	<dt>ChannelTitle</dt>
	<dd>Real title of the RSS Feed "channel"</dd>

	<dt>ChannelDescription</dt>
	<dd>Description of this channel</dd>

	<dt>ChannelLink</dt>
	<dd>Link to the homepage of this channel</dd>

	<dt>Entries</dt>
	<dd>These are the entries received from the RSS Feed file<br />
	It has the following format: <code>Entries=(Title=&lt;entry title&gt;,Link=&lt;entry link&gt;,Desc=&lt;entry description&gt;)</code><br />
</dl>
The package comes with a preconfigured RSS.ini.example file that contains configuration (disabled by default) for RSS feeds from:
<ul>
<li><a href="http://www.beyondunreal.com" target="_blank">Beyond Unreal</a></li>
<li><a href="http://www.unrealadmin.org" target="_blank">the Unreal Admin page</a></li>
<li><a href="http://games.slashdot.org" target="_blank">SlashDot: Games</a></li>
</ul>

<h4>Local RSS Feed configuration</h4>
When you host multiple servers from the same location but with different admins running the servers (normal GISP concept). You might want to store the RSS Feed Configuration to the server's configuration file. <br />
To set this up you need to add the following to the configuration of MutRSS<br />
<pre>
[ServerExt.MutRSS]
RSSFeedRecordClassName=%clientpackage%.LocalRSSFeedRecord
</pre>
%clientpackage% is automatically renamed to the Client Side package for this release.

<h2>Usage</h2>
When installed as a mutator, and bInteractive set to true, users can use the RSS Feeds at their request via the "mutate" command.<br />
All commands start with <code>mutate rss</code>, after which the following commands are accepted:
<table>
<tr>
	<td><code>help</code></td>
	<td>shows a help overview</td>
</tr>
<tr>
	<td><code>browser</code></td>
	<td>show client side browser, if it's enabled</td>
</tr>
<tr>
	<td><code>list</code></td>
	<td>show feed list</td>
</tr>
<tr>
	<td><code>show n [m]</code></td>
	<td>show m items from feed #n, m is 5 by default</td>
</tr>
<tr>
	<td colspan="2">Admin commands</td>
</tr>
<tr>
	<td><code>start</code></td>
	<td>start the mutator, when it's disabled</td>
</tr>
<tr>
	<td><code>stop</code></td>
	<td>stop the mutator</td>
</tr>
<tr>
	<td><code>update n</code></td>
	<td>force an update on RSS feed #n</td>
</tr>
<tr>
	<td><code>enable n</code></td>
	<td>enable RSS feed #n</td>
</tr>
<tr>
	<td><code>disable n</code></td>
	<td>disable RSS feed #n</td>
</tr>
<tr>
	<td><code>remove n</code></td>
	<td>remove RSS feed #n/td>
</tr>
<tr>
	<td><code>add name location</code></td>
	<td>add a new RSS feed with name and download location</td>
</tr>
</table>

<hr />
<a name="teambalance"></a><h1>Team Balance mutator</h1>
The Team Balance mutator will correct the team sizes when needed. Key players/bots (flag carriers) will never be balanced.

<h2>Installation</h2>
Since this is simply a mutator it works like any other mutator. The class name of this mutator is <code>ServerExt.mutTeamBalance</code>.

<h2>Configuration</h2>
<pre>
[ServerExt.mutTeamBalance]
bAnnounce=true
fLingerTime=0
iSizeThreshold=2
bIgnoreWinning=false
fTeamScoreThreshold=-1
bOnlyBalanceOnRequest=false
fTeamBalanceDelay=5
bIgnoreReservedSlots=false
bBotsBalance=true
bAddBots=true
iMaxBots=-1
bBotsFill=false
bSwitchPlayersBack=true
BalanceMethod=BM_Newest
</pre>
<dl>
	<dt>bAnnounce</dt>
	<dd>If true announce this mutator in the server details</dd>

	<dt>fLingerTime</dt>
	<dd>number seconds since the beginning of the game that the team balancer will remain inactive.</dd>

	<dt>iSizeThreshold</dt>
	<dd>The size difference between teams before it's considered uneven, 2 is really the minimum</dd>

	<dt>bIgnoreWinning</dt>
	<dd>If set to true, don't take into account if the smaller team is winning</dd>

	<dt>fTeamScoreThreshold</dt>
	<dd>Difference in teamscore before it's considered winning (used when checking
	if the smallest team is winning), should be 0 or less because with -1 the
	score difference has to be at least 2</dd>

	<dt>bOnlyBalanceOnRequest</dt>
	<dd>Only balance the teams when it's requested via: mutate balance</dd>

	<dt>fTeamBalanceDelay</dt>
	<dd>Number of seconds to wait befor balancing the team automatically</dd>

	<dt>bIgnoreReservedSlots</dt>
	<dd>If set to true, that entered bassed on a reserved slot (requires the Reserved Slots addon) will not be balanced. Only the reserved slots
	with IP, Hash or PlayerName can be checked. Reserved slots based on the password or any other part of the connect url can't be checked.</dd>

	<dt>bBotsBalance</dt>
	<dd>Balance bots first. This only works if there are bots on the server, or MinPlayers has been set.</dd>

	<dt>bAddBots</dt>
	<dd>Add bots to balance the teams first.</dd>

	<dt>iMaxBots</dt>
	<dd>The absolute maximum number of bots allowed. If set to -1 it will use the maximum recommended player count for the current map, if set to
	-2 it will use the minimum recommended player count (both corrected with the current player count).</dd>

	<dt>bBotsFill</dt>
	<dd>When the game isn't unbalanced, but the team sizes are not equal bots will correct the team size</dd>

	<dt>bSwitchPlayersBack</dt>
	<dd>If a user switches team when the teams are unbalanced switch the user back to his old team (when he tried to join the bigger team). If set
	to false it will use the standard balancing method.</dd>

	<dt>BalanceMethod</dt>
	<dd>Various balance methods:<br />
	Balance players based on their join time (BM_Oldest, BM_Newest).<br />
	Balance players based on their gaming performance, their performance is
	defined by their score/death ration (BM_Worst, BM_Best).<br />
	Or just randomly (BM_Random). Key players are never balanced.</dd>

</dl>

<hr />
<h2>License for LibHTTP3</h2>
<pre>
<a href="http://wiki.beyondunreal.com/wiki/LesserOpenUnrealModLicense">Lesser Open Unreal Mod License</a>
Version 1, March 2004

0. Definitions
"Program"       the work, either in binary or source form, that has a notice
				attached to it stating that it has been released under this
				license it by the copyright holder.
"Modification"  a derivate of the Program or any other work based on the Program
"Linking"       using parts of the Program, or using parts of any other work,
				thus creating a direct dependency
"You"           the licensee
"Runtime Environment"
				the virtual machine or operating system required to run the
				Program, as released by the Publisher or Creator of said
				runtime Environment. This includes any extentions or updates
				for the runtime Environment released by the Publisher or
				Creator.

1. License
Herewith everybody is granted permission to copy and distribute verbatim copies
of this document. The only restriction lies on changing the content, with the
exception to translation of this license.

This license applies to the Program that has been released under this license.
The license only applies to copying, distribution and modification of the
Program. Execution or output of the Program are not covered by this license,
however the right for additional limitations on the use (that do not cover
copying, distribution or modification) is granted to the copyright holder.
This license is only valid when all terms in this license comply with the
licenses of the dependecies of the Program. This includes the license of the
possible required runtime Environment.

2. Copying and distribution
You are granted to copy or distribute verbatim copies of the Program, on any
medium, or in any format as you see fit. You are not limited to charging a fee
for the physical act of transferring the copy, nor are you limited to provide
warranty for the Program in return of a fee. Unless this is prohibited by the
license of the Runtime Envoirement.

Any distribution of the program should be accompanied with a verbatim copy of
this license.

3. Modification
You are allowed to modify the Program, or portions of it, therefore making it a
derivate of the Program. You are allowed to distribute your modifications under
the following conditions:
		- You must clearly state that it is a modification or derivate of the
		  Program
		- The original copyright notice must be kept intact
		- The modified files must contain notices of the changed made to it
		- The Modification must be released under the same license as the Program
		- Distribution happens in compliance with section 2

4. Source
The original source of the Program or Modification must be freely available on
request.

5. Linking
The license grants exclusive right to link with any part of the Runtime
Environment, as provided by the publisher or creator of said Runtime
Environment.
Reusing pieces of source code available in the runtime environment in the
Program is only allowed under the following terms:
		- the "borrowed" code is clearly marked to originate from the runtime
		  environment, quoting the original copyright.
		- the following notice is added to the top of the file:
		  "This file contains portions of code from the runtime environment."

The right to "port" the Program to another runtime environment is reserved for
the copyright holder.

6. NON WARRANTY
THIS SOFTWARE DOES NOT COME WITH A WARRANTY OF ANY KIND, UNLESS NOTED OTHERWISE
BY THE COPYRIGHT HOLDER OR WARRANTY PROVIDER. THE ENTIRE RISK OF THE PERFORMANCE
AND QUALITY OF THE PROGRAM LIES WITH YOU. SHOULD THE PROGRAM PROVE DEFECTIVE,
YOU WILL ASSUME ALL COSTS FOR REQUIRED OF REPAIR OR CORRECTION.
</pre>
